<!doctype html>
<html>
	<head>
		<title>Poker Face</title>
		<meta http-equiv="content-type" content="text-html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<style>
			html, body {
				width: 100%;
				height: 100%;
				overflow: hidden;
				padding: 0 0 0 0;
				margin: 0 0 0 0;
				-webkit-text-size-adjust:none;  /* for iphone */
			}
			div {
			}
			#divContainer {
			}
			#divCanvas {
			}
			#divController {
			}
			#canvasFace {
			}
		</style>
		<script>
			$ = function(e) {
				return document.getElementById(e);
			}
			onload = function() {
				setup();
				layout();
				drawFace();
			}
			onresize = function() {
				layout();
				drawFace();
			}
			changePleasure = function() {
				g.pleasure = Number($('sliderPleasure').value);
				if (g.pleasure < 0) g.pleasure += 1;
				g.pleasure += 100;
				g.pleasure = Math.ceil(g.pleasure / 2);
				drawFace();
			}
			changeFocus = function() {
				g.focus = Number($('sliderFocus').value);
				if (g.focus < 0) g.focus += 1;
				g.focus += 100;
				g.focus = Math.ceil(g.focus / 2);
				drawFace();
			}
			setup = function() {
				g  = {};
				g.focus = 50;
				g.pleasure = 50;
				g.debug = false; 
				var sliPleasure = $('sliderPleasure');
				sliPleasure.oninput = changePleasure;
				sliPleasure.onchange = changePleasure;
				var sliFocus = $('sliderFocus');
				sliFocus.oninput = changeFocus;
				sliFocus.onchange = changeFocus;
			}
			layout = function() {
				g.cliW = document.body.clientWidth;
				g.cliH = document.body.clientHeight;
				var highAspect = true; //(g.cliH/g.cliW > 1);
				
				if (!highAspect) {
					$('divController').style.float = 'left';
					$('divCanvas').style.float = 'right';
				}
				else {
					$('divController').style.float = 'none';
					$('divCanvas').style.float = 'none';
				}

				var controllerH = $('divController').offsetHeight;
				var controllerW = $('divController').offsetWidth;
				var canvasW, canvasH;

				if (!highAspect) {
					canvasH = g.cliH;
					canvasW = g.cliW - controllerW - 5;
				}
				else {
					canvasH = g.cliH - controllerH;
					canvasW = g.cliW;
				}

				g.c = $('canvasFace');
				g.c.width = canvasW;
				g.c.height = canvasH;
			}
			drawFace = function() {
				// draw head
				var c = $('canvasFace');
				var centerX = c.width / 2;
				var centerY = c.height / 2;
				var radius = Math.min(g.c.width, g.c.height) / 2 - 5;
				var pctStroke = .0200;

				var ctx = c.getContext('2d');
				ctx.beginPath();
				ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
				ctx.closePath();
				ctx.fillStyle='#FFFF00';
				ctx.fill();
				ctx.lineWidth = radius * pctStroke;
				ctx.strokeStyle='#000000';
				ctx.stroke();

				// draw eyes
				var pctEye = .2000;
				
				var eyeLeftX = centerX - Math.floor(radius * pctEye);
				var eyeLeftY = centerY;
				var eyeRightX = centerX + Math.floor(radius * pctEye);
				var eyeRightY = centerY;
				var eyeRadius = radius * pctStroke;

				ctx.beginPath();
				ctx.arc(eyeLeftX, eyeLeftY, eyeRadius, 0, 2 * Math.PI, false);
				ctx.closePath();
				ctx.fillStyle='#000000';
				ctx.fill();

				ctx.beginPath();
				ctx.arc(eyeRightX, eyeRightY, eyeRadius, 0, 2 * Math.PI, false);
				ctx.closePath();
				ctx.fill();

				// draw brows
				var pctBrowTop = .4429;
				var pctBrowBottom = -.0500; // use negative pct to go below eyes
				var pctBrowOutside =  .5000;
				var pctBrowInside = .0571;

				var leftBrowLeftX = centerX - Math.floor(radius * pctBrowOutside);
				var leftBrowRightX = centerX - Math.floor(radius * pctBrowInside);

				var browTopMax = centerY - Math.floor(radius * pctBrowTop);
				var browBottomMax = centerY - Math.floor(radius * pctBrowBottom);
				var browHeight = browBottomMax - browTopMax;
				var leftBrowLeftY = browTopMax + (browHeight * ((100 - g.focus)/100));
				var leftBrowRightY = browTopMax + (browHeight * (g.focus/100));

				ctx.beginPath();
				ctx.moveTo(leftBrowLeftX, leftBrowLeftY);
				ctx.lineTo(leftBrowRightX, leftBrowRightY);
				ctx.stroke();

				var rightBrowLeftX = centerX + Math.floor(radius * pctBrowInside);
				var rightBrowRightX = centerX + Math.floor(radius * pctBrowOutside);
				var rightBrowLeftY = leftBrowRightY;
				var rightBrowRightY = leftBrowLeftY;

				ctx.beginPath();
				ctx.moveTo(rightBrowLeftX, rightBrowLeftY);
				ctx.lineTo(rightBrowRightX, rightBrowRightY);
				ctx.stroke();

				// draw mouth
				var pctMouthTop = .26;
				var pctMouthBottom = .66;
				var pctMouthOutside =  .50;
				var pctMouthInside = .36;
				var pctMouthInsideHeight = .140;

				var mouthTopMax = centerY + Math.floor(radius * pctMouthTop);
				var mouthBottomMax = centerY + Math.floor(radius * pctMouthBottom);
				var mouthHeight = mouthBottomMax - mouthTopMax;
				
				var mouthInsideTopMax = centerY + Math.floor(radius * (pctMouthTop-pctMouthInsideHeight));
				var mouthInsideBottomMax = centerY + Math.floor(radius * (pctMouthBottom+pctMouthInsideHeight));
				var mouthInsideHeight = mouthInsideBottomMax - mouthInsideTopMax;

				var mouthLeftX = centerX - Math.floor(radius * pctMouthOutside);
				var mouthLeftY = mouthTopMax + mouthHeight * ((100-g.pleasure)/100);
				var mouthOneX = centerX - Math.floor(radius * pctMouthInside);
				var mouthOneY = mouthInsideTopMax + mouthInsideHeight * (g.pleasure/100);
				var mouthTwoX = centerX + Math.floor(radius * pctMouthInside);
				var mouthTwoY = mouthInsideTopMax + mouthInsideHeight * (g.pleasure/100);
				var mouthRightX =  centerX + Math.floor(radius * pctMouthOutside);
				var mouthRightY = mouthTopMax + mouthHeight * ((100-g.pleasure)/100);

				ctx.beginPath();
				ctx.moveTo(mouthLeftX, mouthLeftY);
				ctx.bezierCurveTo(mouthOneX, mouthOneY, mouthTwoX, mouthTwoY, mouthRightX, mouthRightY);
				ctx.stroke();

				if (g.debug) {
					// draw mouth bezier points
					ctx.beginPath();
					ctx.moveTo(mouthLeftX, mouthLeftY);
					ctx.lineTo(mouthOneX, mouthOneY);
					ctx.lineTo(mouthTwoX, mouthTwoY);
					ctx.lineTo(mouthRightX, mouthRightY);
					ctx.closePath();
					ctx.strokeStyle = 'green';
					ctx.stroke();
	
					// draw mouth boxes
					ctx.beginPath();
					ctx.moveTo(mouthLeftX, mouthTopMax);
					ctx.lineTo(mouthRightX, mouthTopMax);
					ctx.lineTo(mouthRightX, mouthBottomMax);
					ctx.lineTo(mouthLeftX, mouthBottomMax);
					ctx.closePath();
					ctx.strokeStyle = 'pink';
					ctx.stroke();
	
					ctx.beginPath();
					ctx.moveTo(mouthOneX, mouthInsideTopMax);
					ctx.lineTo(mouthTwoX, mouthInsideTopMax);
					ctx.lineTo(mouthTwoX, mouthInsideBottomMax);
					ctx.lineTo(mouthOneX, mouthInsideBottomMax);
					ctx.closePath();
					ctx.stroke();
	
					// draw brow boxes
					ctx.beginPath();
					ctx.moveTo(leftBrowLeftX, browTopMax);
					ctx.lineTo(leftBrowRightX, browTopMax);
					ctx.lineTo(leftBrowRightX, browBottomMax);
					ctx.lineTo(leftBrowLeftX, browBottomMax);
					ctx.closePath();
					ctx.stroke();
	
					ctx.beginPath();
					ctx.moveTo(rightBrowLeftX, browTopMax);
					ctx.lineTo(rightBrowRightX, browTopMax);
					ctx.lineTo(rightBrowRightX, browBottomMax);
					ctx.lineTo(rightBrowLeftX, browBottomMax);
					ctx.closePath();
					ctx.stroke();
				}
			}
		</script>
	</head>
	<body>
		<div id='divContainer'>
			<div id='divCanvas'>
				<canvas id='canvasFace'/>
			</div>
			<div id='divController'>
				<table>
					<tr>
						<td>Pleasure:</td>
						<td>
							<input type='range' id='sliderPleasure' min='-100' max='100' step='1' value='0'/>
						</td>
					</tr>
					<tr>
						<td>Focus:</td>
						<td>
							<input type='range' id='sliderFocus' min='-100' max='100' step='1' value='0'/>
						</td>
					</tr>
				</table>
			</div>
		</div>
	</body>
</html>
